<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üõ°Ô∏è BullyGuard AI</title>

<!-- Manifest -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#667eea" />

<style>
/* --- same styles you had before --- */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;padding:20px;color:white;}
.container{max-width:400px;margin:0 auto;padding:20px;}
.header{text-align:center;margin-bottom:30px;}
.title{font-size:2.2em;font-weight:bold;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.3);}
.subtitle{font-size:1.1em;opacity:0.9;margin-bottom:30px;}
.camera-section,.quick-actions,.results-section{background:rgba(255,255,255,0.1);
  border-radius:20px;padding:20px;margin-bottom:20px;backdrop-filter:blur(10px);}
.upload-area{border:3px dashed rgba(255,255,255,0.5);border-radius:15px;
  padding:40px 20px;text-align:center;margin-bottom:20px;transition:all 0.3s ease;cursor:pointer;}
.upload-icon{font-size:3em;margin-bottom:15px;opacity:0.8;}
.upload-text{font-size:1.1em;margin-bottom:10px;}
.btn{width:100%;padding:15px;border:none;border-radius:25px;font-size:1.1em;
  font-weight:bold;cursor:pointer;transition:all 0.3s ease;margin-bottom:10px;}
.btn-camera{background:linear-gradient(45deg,#ff6b6b,#ee5a52);color:white;}
.btn-gallery{background:linear-gradient(45deg,#4ecdc4,#44a08d);color:white;}
.btn-report{background:linear-gradient(45deg,#e74c3c,#c0392b);color:white;}
.btn-emergency{background:linear-gradient(45deg,#e74c3c,#c0392b);color:white;animation:pulse 2s infinite;}
.btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,0.2);}
.results-title{font-size:1.3em;font-weight:bold;margin-bottom:15px;}
.result-item{background:rgba(255,255,255,0.1);padding:15px;border-radius:10px;margin-bottom:10px;}
.result-safe{border-left:4px solid #2ecc71;}
.result-danger{border-left:4px solid #e74c3c;}
.loading{display:none;text-align:center;padding:20px;}
.spinner{border:4px solid rgba(255,255,255,0.3);border-radius:50%;
  border-top:4px solid white;width:50px;height:50px;animation:spin 1s linear infinite;margin:0 auto 15px;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
@keyframes pulse{0%{transform:scale(1);}70%{transform:scale(1.05);}100%{transform:scale(1);}}
.preview-image{max-width:100%;max-height:300px;border-radius:10px;margin:15px 0;}
#file-input-camera,#file-input-gallery{display:none;}
.install-btn{position:fixed;bottom:20px;right:20px;background:rgba(255,255,255,0.2);
  border:none;border-radius:50%;width:60px;height:60px;font-size:24px;cursor:pointer;
  backdrop-filter:blur(10px);box-shadow:0 4px 12px rgba(0,0,0,0.2);display:none;z-index:1000;color:white;}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="title">üõ°Ô∏è Anti-Bullying AI</div>
    <div class="subtitle">Photo-based detection system</div>
  </div>

  <div class="quick-actions">
    <div class="results-title">‚ö° Quick Actions</div>
    <button class="btn btn-emergency" onclick="triggerEmergencyAlert()">üö® Emergency Alert</button>
  </div>

  <div class="camera-section">
    <div class="upload-area" id="upload-area">
      <div class="upload-icon">üì∏</div>
      <div class="upload-text">Tap to take photo or upload image</div>
    </div>
    <input type="file" id="file-input-camera" accept="image/*" capture="environment">
    <input type="file" id="file-input-gallery" accept="image/*">
    <button class="btn btn-camera" onclick="takePhoto()">üì∑ Take Photo</button>
    <button class="btn btn-gallery" onclick="openGallery()">üñºÔ∏è Choose from Gallery</button>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <div>üîç Analyzing image...</div>
  </div>

  <div class="results-section" id="results" style="display:none;">
    <div class="results-title">üìä Detection Results</div>
    <div id="results-content"></div>
    <div id="report-section" style="display:none;">
      <button class="btn btn-report" onclick="reportToContacts()">üì§ Send Report</button>
    </div>
  </div>
</div>

<button id="installBtn" class="install-btn">üì≤</button>

<script>
// === RoboFlow ===
const ROBOFLOW_API_KEY = "1RuIGDSVW5gVOPaIq5I7";
const MODEL_ENDPOINT = "https://detect.roboflow.com/bullying-detection-lixke-xxmrf/1";

// Elements
const fileCamera=document.getElementById("file-input-camera");
const fileGallery=document.getElementById("file-input-gallery");
const loading=document.getElementById("loading");
const results=document.getElementById("results");
const resultsContent=document.getElementById("results-content");
const reportSection=document.getElementById("report-section");

// Contacts
let contacts=JSON.parse(localStorage.getItem("contacts"))||[
  {name:"Mom", number:"01111111111"},
  {name:"Teacher", number:"01222222222"}
];

// File handling
function takePhoto(){fileCamera.click();}
function openGallery(){fileGallery.click();}
[fileCamera,fileGallery].forEach(input=>{
  input.addEventListener("change",e=>handleFile(e.target.files[0]));
});
function handleFile(file){if(file) analyzeImage(file);}

// Analyze
async function analyzeImage(file){
  loading.style.display="block";
  results.style.display="none";
  reportSection.style.display="none";
  const formData=new FormData();
  formData.append("file",file);
  try{
    const response=await fetch(`${MODEL_ENDPOINT}?api_key=${ROBOFLOW_API_KEY}`,{method:"POST",body:formData});
    const result=await response.json();
    console.log(result);
    const predictions=result.predictions;
    if(predictions&&predictions.length>0){
      displayResult(predictions[0].class);
    }else{displayResult("none");}
  }catch(err){
    console.error(err);
    resultsContent.innerHTML="<div class='result-item'>‚ö†Ô∏è Error analyzing image.</div>";
  }
  loading.style.display="none";
}
function displayResult(label){
  results.style.display="block";
  resultsContent.innerHTML="";
  let div=document.createElement("div");
  if(label.toLowerCase().includes("bully")){
    div.className="result-item result-danger";
    div.innerHTML="üö® Bullying Detected!";
  }else if(label.toLowerCase().includes("kind")){
    div.className="result-item result-safe";
    div.innerHTML="üòä Kindness Detected!";
  }else{
    div.className="result-item";
    div.innerHTML="‚ÑπÔ∏è No clear bullying/kindness detected.";
  }
  resultsContent.appendChild(div);
  reportSection.style.display="block";
}

// Reporting
function reportToContacts(){
  navigator.geolocation.getCurrentPosition(pos=>{
    let location=`Location: https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    contacts.forEach(c=>{
      window.open(`sms:${c.number}?body=Bullying report detected! ${location}`);
    });
  });
}

// Emergency
function triggerEmergencyAlert(){alert("üö® Emergency alert sent!");}

// PWA
if("serviceWorker" in navigator){navigator.serviceWorker.register("service-worker.js");}
let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();deferredPrompt=e;
  document.getElementById("installBtn").style.display="block";
});
document.getElementById("installBtn").addEventListener("click",()=>{deferredPrompt.prompt();});
</script>
</body>
</html>
